/*
	UIZE JAVASCRIPT FRAMEWORK 2010-07-14

	http://www.uize.com/reference/Uize.Wsh.BuildUtils.html
	Available under MIT License or GNU General Public License -- http://www.uize.com/license.html
*/
Uize.module({name:'Uize.Wsh.BuildUtils',required:['Uize.Url','Uize.Template','Uize.Data.Simple','Uize.String.Lines','Uize.Json'],builder:function(){var _a=function(){};var _b={};function _c(_d){return _d}_a.getHtmlFilesInfo=function(_e,_f){var _g=[];if(!_f)_f=_c;for(var _h= -1,_i=Uize.Wsh.getFiles(_e),_j=_i.length;++_h<_j;){var _k=_i[_h],_l=Uize.Url.from(_k).file;if(/\.html$/i.test(_l)&&_l.charAt(0)!='~'){var _m=Uize.Wsh.readFile(_k),_n=_m.match(/<meta name="keywords" content="(.*?)"\/>/),_o=_m.match(/<meta name="description" content="(.*?)"\/>/),_p=_m.match(/<link rel="image_src" href="(.*?)"\/>/);_g.push({path:_e+'/'+_l,title:_f(_m.match(/<title>(.*?)<\/title>/)[1]),keywords:_n?_n[1]:'',description:_o?_o[1]:'',imageSrc:_p?Uize.Url.toAbsolute(_e,_p[1]):''});}}_g.sort(function(_q,_r){return((_q._s||(_q._s=_q.title.toLowerCase()))<(_r._s||(_r._s=_r.title.toLowerCase()))? -1:1);});for(var _h= -1,_t=_g.length;++_h<_t;)delete _g[_h]._s;return _g;};_a.readSimpleDataFile=function(_u){
return Uize.Data.Simple.parse({simple:Uize.Wsh.readFile(_u),collapseChildren:true});};_a.compileJstFile=function(_v){var _w=_b[_v];if(!_w){if(!Uize.Wsh.fileExists(_v))return;_w=_b[_v]=Uize.Template.compile(Uize.Wsh.readFile(_v),{result:'full'});Uize.module({required:_w.required});}return _w.templateFunction;};_a.processJstFile=function(_v,_x){var _w=_a.compileJstFile(_v);_w&&Uize.Wsh.writeFile({path:_v.replace(/\.jst$/,''),text:_w(_x)});};_a.runScripts=function(_y){var _z;if(!Uize.isArray(_y))_y=[_y];for(var _A= -1,_B=_y.length,_C=new ActiveXObject('WScript.Shell'),_D;++_A<_B&& !_z;)if(_D=_C.Run('WScript '+_y[_A],0,true))_z={script:_y[_A],errorCode:_D};return _z;};_a.runUnitTests=function(_E){Uize.module({required:_E,builder:function(){var _F=new(eval(_E));_F.wire('Done',function(_G){var _H=_G.source,_I=_H.get('result');if(!_I||_H==_F){(WScript.Arguments.Count()&&WScript.Arguments.Item(0)=='silent')||alert(_H.getSynopsis());_I||WScript.Quit(1);}});_F.run();}});};_a.writeDataModule=function(_J,_K,_L){
Uize.Wsh.writeFile({path:_J+'\\'+_K+'.js',text:'Uize.module ({\n'+'\tname:\''+_K+'\',\n'+'\tbuilder:function () {\n'+'\t\treturn function () {\n'+'\t\t\treturn '+Uize.String.Lines.indent(Uize.Json.to(_L),3,'\t',false)+';\n'+'\t\t};\n'+'\t}\n'+'});\n'});};return _a;}});