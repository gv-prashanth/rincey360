/*
	UIZE JAVASCRIPT FRAMEWORK 2010-07-21

	http://www.uize.com/reference/Uize.Widget.Drag.html
	Available under MIT License or GNU General Public License -- http://www.uize.com/license.html
*/
Uize.module({name:'Uize.Widget.Drag',required:['Uize.Node','Uize.Node.Event'],builder:function(c_a){var c_b,c_c=true,c_d=false,c_e=null,c_f=Uize.Node,c_g=c_f.isIe;var c_h,c_i=typeof navigator!='undefined'&&(!c_g||navigator.appVersion.indexOf('MSIE 6')== -1)&&navigator.userAgent.indexOf('Firefox/2')<0;var c_j=c_a.subclass(function(){var c_k=this;c_k.eventStartPos=c_k.c_l=[0,0];c_k.eventPos=c_k.c_m=[0,0];c_k.c_n=[0,0];c_k.c_o=c_k.c_p=0;c_k.eventDeltaPos=c_k.c_q=[0,0];}),c_r=c_j.prototype;c_r.c_s=function(c_t){if(this.c_u){var c_v=c_t.targetTouches[0];return{clientX:c_v.pageX,clientY:c_v.pageY};}return c_t;};c_r.c_w=function(){this.c_x=null;this.fire('Drag Rest');};c_r.c_y=function(){this.c_x&&clearTimeout(this.c_x);this.c_x=null;};c_r.c_z=function(){var c_k=this;if(c_k.isWired){var c_A=c_k.getNode();c_k.c_B?c_f.setStyle(c_k.c_C?[c_A,c_h]:c_A,{cursor:c_k.get('enabledInherited')?c_k.c_B:'not-allowed'}):c_k.set({c_B:c_f.getStyle(c_A,'cursor')});}};c_r.initiate=c_r.mousedown=function(c_t,c_D){var c_k=this;
if(!c_k.c_C&&c_k.get('enabledInherited')){var c_l=c_k.c_l,c_m=c_k.c_m,c_n=c_k.c_n,c_u= !!c_t.targetTouches;c_k.set({c_C:c_c,c_u:c_u});c_k.c_z();Uize.Node.Event.abort(c_t);c_k.c_E=c_t.shiftKey?'one':'both';c_k.fire({name:'Before Drag Start',domEvent:c_t});var c_F=c_k.c_s(c_t);c_l[0]=c_m[0]=c_n[0]=c_F.clientX;c_l[1]=c_m[1]=c_n[1]=c_F.clientY;c_k.c_o=c_k.c_p= +new Date;var c_G=c_d,c_H;if(!c_u)c_H={onkeyup:document.onkeyup,onmousemove:document.onmousemove,onmouseup:document.onmouseup};function c_I(c_t){if(c_k.c_C){c_G=c_c;if(c_k.c_x){c_k.c_y();c_k.c_w();}c_k.set({c_C:c_d,c_u:c_d});c_k.fire({name:'Drag Done',domEvent:c_t});c_k.set({c_J:c_d,c_K:c_d});if(c_u){c_k.unwireNode(c_D?'':c_t.target,{touchmove:null,touchend:null,touchcancel:null});}}}function c_L(c_M,c_N,c_O){Uize.Fade.fade(c_P,[c_m[0],c_m[1]],c_M,c_N,c_O).wire('Done',function(){c_I(c_t)});}function c_Q(c_t){if(c_k.c_R&&Uize.Fade&&Uize.Fade.fade){var c_S=c_m[0]-c_n[0],c_T=c_m[1]-c_n[1];if(c_S||c_T){var c_U=Math.sqrt(Math.pow(c_S,2)+Math.pow(c_T,2)),
c_V=c_k.c_R(c_U/((c_k.c_o-c_k.c_p)||1)*1000),c_W=1+(c_V.distance/c_U);c_L([c_n[0]+c_S*c_W,c_n[1]+c_T*c_W],c_V.duration*1000,{curve:c_V.curve});return;}}c_I(c_t);}function c_P(c_X,c_Y){c_k.c_p=c_k.c_o;c_k.c_o= +new Date;c_n[0]=c_m[0];c_n[1]=c_m[1];var c_q=[(c_m[0]=c_X)-c_l[0],(c_m[1]=c_Y)-c_l[1]],c_Z=[Math.abs(c_q[0]),Math.abs(c_q[1])];for(var c_0= -1;++c_0<2;)c_k.c_q[c_0]=(c_k.c_E=='both'||c_Z[c_0]>c_Z[1-c_0]||(c_Z[c_0]==c_Z[1-c_0]&&c_0==1))?c_q[c_0]:0;c_k.fire('Drag Update');c_k.c_y();c_k.c_x=setTimeout(function(){c_k.c_w()},c_k.c_1);}function c_2(c_t){if(!c_G&& !c_k.c_J){if(!c_k.c_K){if(!c_u){c_j.resizeShield(c_h);c_f.display(c_h);}c_k.set({c_K:c_c});c_k.fire({name:'Drag Start',domEvent:c_t});}var c_F=c_k.c_s(c_t);c_P(c_F.clientX,c_F.clientY);}}function c_3(c_t){c_k.set({c_J:c_c});if(c_k.c_4&&Uize.Fade&&Uize.Fade.fade){c_L(c_l,500,c_k.c_4);}else{c_P(c_l[0],c_l[1]);c_I(c_t);}}if(c_u){c_k.wireNode(c_D?'':c_t.target,{touchmove:function(c_t){c_t.preventDefault();c_2(c_t);},touchend:function(c_t){
c_t.preventDefault();c_Q(c_t);},touchcancel:function(c_t){c_t.preventDefault();c_3(c_t);}});}else{function c_5(c_t){Uize.copyInto(document,c_H);c_f.display(c_h,c_d);c_k.c_J||c_Q(c_t);}document.onmousemove=function(c_t){c_t||(c_t=window.event);c_g&&c_t.button==0?c_k.c_C&&c_5(c_t):c_2(c_t);return c_d;};document.onmouseup=function(c_t){c_5(c_t||window.event);return c_d;};document.onkeyup=function(c_t){Uize.Node.Event.isKeyEscape(c_t)&&c_k.c_C&&c_3(c_t);};}}return c_d;};c_r.updateUi=function(){var c_k=this;c_k.isWired&& !c_k.get('enabledInherited')||c_k.c_B&&c_k.c_z();};c_r.wireUi=function(){var c_k=this;if(!c_k.isWired){var c_6=c_k.getNode();if(c_6){c_6.onmousedown=c_f.returnFalse;function c_7(c_t){return c_k.initiate(c_t,c_c)}c_k.wireNode(c_6,{mousedown:c_7,touchstart:c_7});}if(!c_h)c_h=c_j.insertShield({zIndex:50000});c_k.wire({'Changed.enabledInherited':function(){c_k.c_z()}});c_a.prototype.wireUi.call(c_k);}};c_j.getEventPagePos=function(c_t){if(c_t.targetTouches)c_t=c_t.targetTouches[0];
if('pageX'in c_t)return c_t;var c_8=document.documentElement;return{pageX:c_t.clientX+c_8.scrollLeft,pageY:c_t.clientY+c_8.scrollTop};};c_j.insertShield=function(c_9){var c_ba={display:'none',position:'absolute'};if(c_g)c_ba.background='url('+c_j.getBlankImageUrl()+')';var c_bb=document.createElement('div');c_f.setStyle(c_bb,c_j.copyInto(c_ba,c_9));c_bb.Uize_Widget_Drag_shield=c_c;document.body.appendChild(c_bb);c_j.resizeShield(c_bb);return c_bb;};c_j.resizeShield=function(c_bb){if(c_i){c_f.setStyle(c_bb,{left:'0',top:'0',width:'100%',height:'100%',position:'fixed'});}else{var c_bc=c_f.getStyle(c_bb,'display'),c_8=document.documentElement,c_bd=document.body;c_f.display(c_bb,c_d);c_f.setStyle(c_bb,{left:0,top:0,width:c_8.scrollWidth,height:Math.max(typeof window.innerHeight=='number'?window.innerHeight:(c_8&&c_8.clientHeight?c_8.clientHeight:(c_bd&&c_bd.clientHeight?c_bd.clientHeight:0)),c_8.scrollHeight),display:c_bc});}};c_j.registerProperties({c_be:{name:'animation',
onChange:function(){this.set({c_4:this.c_be?{duration:500}:c_b})}},c_4:'cancelFade',c_B:{name:'cursor',onChange:c_r.c_z},c_J:{name:'dragCancelled',value:c_d},c_1:{name:'dragRestTime',value:250},c_K:{name:'dragStarted',value:c_d},c_C:{name:'inDrag',value:c_d},c_u:{name:'isTouch',value:c_d},c_R:'releaseTravel'});!c_i&&c_a.wire('Window Resized',function(){c_j.resizeShield(c_h)});return c_j;}});