/*
	UIZE JAVASCRIPT FRAMEWORK 2010-07-19

	http://www.uize.com/reference/Uize.Test.html
	Available under MIT License or GNU General Public License -- http://www.uize.com/license.html
*/
Uize.module({name:'Uize.Test',required:['Uize.Data','Uize.Json'],builder:function(b_a){var b_b=true,b_c=false,b_d;var b_e=typeof navigator=='object',b_f='\n----------------------------------------------------------\n\n';var b_g=b_a.subclass(),b_h=b_g.prototype;function b_i(b_j,b_k){if(b_k==b_d)return b_j==b_d;if(b_j==b_d)return b_k==Object;if(!(b_j instanceof Function))b_j=b_j.constructor;if(!(b_k instanceof Function))b_k=b_k.constructor;while(b_j!=b_k&&typeof(b_j=b_j.superclass)=='function');return b_j==b_k;}function b_l(b_m){if(b_i(b_m,Uize))return b_m.moduleName||'';var b_n=(b_m+'').match(/function\s+([^\(]+)\s*\(/);return b_n?b_n[1]:'';}function b_o(b_p){return function(){return Uize.Json.to(b_p)};}b_h.b_q=function(b_r,b_s,b_t){b_r||this.set({b_u:'EXPECTED:\n\n'+(typeof b_s=='function'?b_s():b_s)+'\n\n'+'ACTUAL:\n\n'+b_t()});return b_r;};b_h.expect=function(b_v,b_p){return this.b_q(Uize.Data.identical(b_v,b_p),b_o(b_v),b_o(b_p));};b_h.expectNonNull=function(b_p){return this.b_q(b_p!=null,
'value that is not null or undefined',b_o(b_p));};b_h.expectInstanceOf=function(b_g,b_p){return this.b_q(typeof b_p=='object'&&b_p&&b_p.constructor==(typeof b_g=='string'?eval(b_g):b_g).prototype.constructor,function(){return'instance of '+b_l(b_g)},function(){return'instance of '+b_l(b_p.constructor)});};b_h.expectType=function(b_w,b_p){return this.b_q(typeof b_p==b_w,function(){return'type '+b_w},function(){return'type '+typeof b_p});};b_h.expectArray=function(b_p){return this.expectInstanceOf(Array,b_p);};b_h.expectBoolean=function(b_p){return this.expectType('boolean',b_p);};b_h.expectFunction=function(b_p){return this.expectType('function',b_p);};b_h.expectNumber=function(b_p){return this.expectType('number',b_p);};b_h.expectObject=function(b_p){return this.expectType('object',b_p);};b_h.expectRegExp=function(b_p){return this.expectInstanceOf(RegExp,b_p);};b_h.expectString=function(b_p){return this.expectType('string',b_p);};b_h.expectArrayLike=function(b_p){
return this.b_q(Uize.isArray(b_p),'array like',b_o(b_p));};b_h.expectValueRange=function(b_x,b_y,b_p){return this.b_q(b_p>=b_x&&b_p<=b_y,function(){return'value within range '+b_x+' to '+b_y},b_o(b_p));};b_h.expectNegativeValue=function(b_p){return this.expectValueRange(-Infinity,0,b_p);};b_h.expectPositiveValue=function(b_p){return this.expectValueRange(0,Infinity,b_p);};b_h.expectLengthRange=function(b_z,b_A,b_p){var b_B=b_p.length;return this.b_q(b_B>=b_z&&b_B<=b_A,function(){return'length within range '+b_z+' to '+b_A},function(){return b_B});};b_h.expectNonEmpty=function(b_p){return this.b_q(!Uize.Data.isEmpty(b_p),'non-empty',b_o(b_p));};b_h.expectInteger=function(b_p){return this.b_q(Math.floor(b_p)== +b_p,'integer',b_o(b_p));};b_h.expectNegativeInteger=function(b_p){return this.expectInteger(b_p)&&this.expectNegativeValue(b_p);};b_h.expectPositiveInteger=function(b_p){return this.expectInteger(b_p)&&this.expectPositiveValue(b_p);};b_h.expectNoRepeats=function(b_C){
return Uize.Data.getTotalKeys(Uize.Data.getLookup(b_C))==b_C.length;};b_h.expectNonEmptyArray=function(b_p){return this.expectArray(b_p)&&this.expectNonEmpty(b_p);};b_h.expectNonEmptyObject=function(b_p){return this.expectObject(b_p)&&this.expectNonEmpty(b_p);};b_h.expectNonEmptyString=function(b_p){return this.expectString(b_p)&&this.expectNonEmpty(b_p);};b_h.getDepth=function(){var b_D=0,b_E=this;while(b_E=b_E.parent)b_D++;return b_D;};b_h.getTotalTests=function(){var b_F=0;function b_G(b_H){b_F++;if(Uize.isArray(b_H)){for(var b_I= -1,b_J=b_H.length;++b_I<b_J;)b_G(b_H[b_I].b_K);}}b_G(this.b_K);return b_F;};b_h.getSynopsis=function(){var b_L=this,b_M=b_L.b_M,b_N=b_M?'PASSED':'FAILED',b_u=b_L.b_u;if(!b_M&&b_u){b_N+='\n'+b_f;var b_O=b_L,b_P=[],b_Q='',b_R='';while(b_O){b_P.push(b_O.b_S);b_O=b_O.parent;}for(var b_T=b_P.length;--b_T> -1;){b_Q+=b_R+b_P[b_T]+'\n';b_R+='   ';}b_N+='BREADCRUMBS...\n\n'+b_Q+b_f+'REASON FOR FAILURE...\n\n'+b_u;}return b_N;};b_h.stop=function(){var b_L=this,b_H=b_L.b_K;
if(Uize.isArray(b_H)){for(var b_I= -1,b_J=b_H.length;++b_I<b_J;)b_H[b_I].stop();}b_L.set({b_U:false});};b_h.run=function(b_V){var b_L=this,b_K=b_L.b_K,b_W=b_b;b_L.stop();b_L.set({b_U:b_b,b_X:0,b_Y:new Date,b_Z:b_d,b_0:b_c,b_1:[],b_M:b_d,b_u:b_d});b_L.fire({name:'Start',bubble:b_b});function b_2(){b_L.set({b_M:b_W});if(b_W==b_0){b_L.set({b_0:b_b});}else{var b_Z=new Date;b_L.set({b_3:b_Z-b_L.b_Y,b_Z:b_Z,b_X:1});b_L.stop();b_L.fire({name:'Done',bubble:b_b});b_L.b_0&&b_V&&b_V(b_W);}}if(Uize.isArray(b_K)){var b_4=b_K.length,b_5= -1;function b_6(){b_L.set({b_X:(b_5+1)/b_4});function b_7(b_M){b_W=b_M;b_6();}while(b_L.b_U&&b_W===b_b&& ++b_5<b_4)b_W=b_K[b_5].run(b_7);b_2();}b_6();}else{try{b_W=b_0;var b_8=b_c,b_9=b_K.call(b_L,function(b_M){b_W=b_M;b_8&&b_2();});if(b_9!==b_d)b_W=b_9;b_8=true;}catch(b_ba){b_L.set({b_u:'JavaScript Error...\n'+'ERROR NAME: '+b_ba.name+'\n'+'ERROR MESSAGE: '+b_ba.message+'\n'+'ERROR DESCRIPTION: '+b_ba.description+'\n'+'LINE NUMBER: '+b_ba.number+'\n'});b_W=b_c;}if(b_W!=b_0&&b_e){
var b_bb=b_W;b_W=b_0;b_2();setTimeout(function(){b_W=b_bb;b_2();},0);}else{b_2();}}return b_W;};var b_0=b_g.isAsync={};b_g.addTest=function(b_K){(this.b_K||(this.b_K=[])).push(b_K);};b_g.log=function(b_bc){this.b_1.push({timestamp:new Date,message:b_bc});};var b_bd=b_g.splitHostAndProperty=function(b_be){var b_bf=b_be.lastIndexOf('.');return{host:b_be.slice(0,b_bf),property:b_be.slice(b_bf+1)};};b_g.declare=function(b_K){var b_bg=b_i(b_K,b_g),b_bh=b_bg?b_K:b_g.subclass();var b_H=b_bg?b_K.b_K:b_K.test;if(Uize.isArray(b_H)){for(var b_I= -1,b_J=b_H.length,b_bi;++b_I<b_J;)if((b_bi=b_H[b_I]).constructor==Object)b_H[b_I]=b_g.declare(b_bi);}b_bg||b_bh.set(b_K);return b_bh;};b_g.requiredModulesTest=function(b_bj){return Uize.Test.declare({title:'REQUIRED MODULES TEST: '+b_bj,test:function(b_6){Uize.module({required:b_bj,builder:function(){b_6(true)}});}});};b_g.staticPropertyTest=function(b_be,b_w){var b_bk=b_bd(b_be),b_bl=b_bk.host;return b_g.declare({title:'Test that '+b_be+' exists and is a '+b_w,test:[{
title:'Test that host '+b_bl+' is defined',test:function(){return this.expectNonNull(eval(b_bl))}},{title:'Test that '+b_be+' is a '+b_w,test:function(){return this.expectType(b_w,eval(b_bl)[b_bk.property]);}}]});};b_g.staticMethodTest=function(b_bm,b_bn,b_bo){var b_bk=b_bd(b_bm),b_bp=b_bk.host,b_bq=b_bk.property,b_K=[b_g.staticPropertyTest(b_bm,'function')];function b_br(b_bs){return(Uize.isArray(b_bs)?b_g.declare({title:b_bs[0],test:function(){var b_bt=eval(b_bp),b_bu=b_bs[1];return this.expect(b_bs[2],b_bt[b_bq].apply(b_bt,Uize.isArray(b_bu)?b_bu:[b_bu]));}}):b_bs);}for(var b_bv= -1,b_bw=b_bn.length;++b_bv<b_bw;)b_K.push(b_br(b_bn[b_bv]));return b_g.declare(b_g.copyInto({title:'STATIC METHOD TEST: '+b_bm,test:b_K},b_bo));};b_g.staticMethodTests=function(b_bx){var b_K=[];for(var b_by= -1,b_bz=b_bx.length;++b_by<b_bz;){var b_bA=b_bx[b_by];b_K.push(Uize.isArray(b_bA)?b_g.staticMethodTest.apply(this,b_bA):b_bA);}return b_g.declare({title:'Static Method Tests',test:b_K});};b_g.testModuleTest=function(b_bB){
var b_bC=b_g.requiredModulesTest(b_bB);b_bC.set({b_S:'REQUIRE TEST MODULE: '+b_bB});return b_g.declare({title:'TEST MODULE: '+b_bB,test:[b_bC,Uize.Test.declare({title:'RUN TEST MODULE: '+b_bB,test:function(b_6){return(new(eval(b_bB))).run(b_6)}})]});};b_g.testSuite=function(b_bD,b_bE){var b_K=[];for(var b_bF= -1,b_bG=b_bE.length;++b_bF<b_bG;)b_K.push(b_g.testModuleTest(b_bE[b_bF]));return b_g.declare({title:b_bD,test:b_K});};b_g.registerProperties({b_0:'isAsync',b_3:'duration',b_Z:'endTime',b_U:{name:'inProgress',value:b_c},b_1:'log',b_X:{name:'progress',value:0},b_u:'reasonForFailure',b_M:'result',b_K:{name:'test',conformer:function(b_p){if(Uize.isArray(b_p)){var b_H=b_p;b_p=[];for(var b_I= -1,b_J=b_H.length;++b_I<b_J;)b_p.push(new b_H[b_I]({parent:this}));}return b_p;}},b_Y:'startTime',b_S:'title'});return b_g;}});